const fs = require('fs');
const path = require('path');
const { createCanvas } = require('canvas');
const https = require('https');

// Create public directories if they don't exist
const publicDir = path.join(__dirname, '../public');
const imagesDir = path.join(publicDir, 'images');

[publicDir, imagesDir].forEach(dir => {
  if (!fs.existsSync(dir)) {
    fs.mkdirSync(dir, { recursive: true });
  }
});

// Function to generate a simple image with a colored background and text
function generateImage(filename, width, height, bgColor, text, textColor = '#ffffff') {
  const canvas = createCanvas(width, height);
  const ctx = canvas.getContext('2d');
  
  // Draw background
  ctx.fillStyle = bgColor;
  ctx.fillRect(0, 0, width, height);
  
  // Add text if provided
  if (text) {
    ctx.fillStyle = textColor;
    ctx.font = `bold ${Math.floor(Math.min(width, height) * 0.4)}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, width / 2, height / 2);
  }
  
  // Save to file
  const buffer = canvas.toBuffer('image/png');
  fs.writeFileSync(path.join(publicDir, filename), buffer);
  console.log(`✓ Generated ${filename}`);
}

// Generate favicon files
const faviconSizes = [16, 32, 48, 64, 128, 192, 256, 512];
faviconSizes.forEach(size => {
  const filename = size <= 32 ? `favicon-${size}x${size}.png` : `android-chrome-${size}x${size}.png`;
  generateImage(filename, size, size, '#4f46e5', 'R');
});

// Generate apple-touch-icon.png
generateImage('apple-touch-icon.png', 180, 180, '#4f46e5', 'R');

// Generate placeholder images
const placeholderImages = [
  { name: 'avatar.jpg', width: 200, height: 200, text: 'Avatar' },
  { name: 'cover.jpg', width: 1200, height: 630, text: 'Cover' },
  { name: 'ladakh-trip.jpg', width: 800, height: 600, text: 'Ladakh' },
  { name: 'andaman-trip.jpg', width: 800, height: 600, text: 'Andaman' },
  { name: 'bhutan-trip.jpg', width: 800, height: 600, text: 'Bhutan' },
  { name: 'photo1.jpg', width: 400, height: 300, text: 'Photo 1' },
  { name: 'photo2.jpg', width: 400, height: 300, text: 'Photo 2' },
  { name: 'photo3.jpg', width: 400, height: 300, text: 'Photo 3' },
  { name: 'trip-1.jpg', width: 400, height: 300, text: 'Trip 1' },
  { name: 'trip-2.jpg', width: 400, height: 300, text: 'Trip 2' },
  { name: 'trip-3.jpg', width: 400, height: 300, text: 'Trip 3' },
  { name: 'avatar-2.jpg', width: 200, height: 200, text: 'User 2' },
  { name: 'avatar-3.jpg', width: 200, height: 200, text: 'User 3' },
  { name: 'og-image.jpg', width: 1200, height: 630, text: 'Roammate' }
];

// Generate all placeholder images
placeholderImages.forEach(img => {
  generateImage(
    `images/${img.name}`, 
    img.width, 
    img.height, 
    `#${Math.floor(Math.random()*16777215).toString(16)}`,
    img.text || img.name.split('.')[0]
  );
});

// Create a simple favicon.ico
const ico = Buffer.from([
  0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x10, 0x10, 0x00, 0x00, 0x01, 0x00, 0x20, 0x00, 0x68, 0x04,
  0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x20, 0x00,
  0x00, 0x00, 0x01, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]);

fs.writeFileSync(path.join(publicDir, 'favicon.ico'), ico);
console.log('✓ Generated favicon.ico');

console.log('\n✅ All assets have been generated successfully!');
